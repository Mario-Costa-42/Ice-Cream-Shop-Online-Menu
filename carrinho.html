<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carrinho</title>
  <link rel="icon" type="image/x-icon" href="./assets/emoji-de-sorvete.png">
  <link rel="stylesheet" href="carrinho.css" />
  <style>
    /* Bot√£o WhatsApp */
    #btnWhatsapp {
      background: #25D366;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      gap: 8px;
      margin-top: 15px;
      display: block;
      margin-left: auto;
      margin-right: auto; 
      line-height: 1;
      vertical-align: middle;
    }
    #btnWhatsapp img {
      width: 20px;
      height: 20px;
      vertical-align: middle;
    }
    select, input {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <a href="./menu.html">
    <img src="./assets/arrow_back.svg" alt="In√≠cio" id="home" />
  </a>

  <h1>üõí Carrinho</h1>
  <div id="carrinho"></div>

  <!-- Se√ß√£o de Pagamento -->
  <h2>Forma de Pagamento</h2>
  <select id="pagamento" onchange="mostrarOpcaoPagamento()">
    <option value="">Selecione...</option>
    <option value="pix">Pix</option>
    <option value="dinheiro">Dinheiro</option>
  </select>

  <div id="pixInfo" style="display:none; margin-top:10px;">
    <p>Escaneie o QR Code ou copie a chave Pix:</p>
    <img src="./assets/pixQRcode.jpg" id="qrcode" alt="QR Code Pix" width="150">
    <br><br>
    <button id="textCopyPix" onclick="copiarPix()">üìã Copiar Chave Pix</button>
  </div>

  <div id="dinheiroInfo" style="display:none; margin-top:10px;">
    <label>Vai precisar de troco?</label>
    <br>
    <input style="text-align: center;" type="number" id="troco" placeholder="Troco para quanto?">
  </div>

  <br>
  <button id="btnWhatsapp" onclick="enviarWhatsapp()">
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
    Enviar no WhatsApp
  </button>

  <script>
    function carregarCarrinho() {
      let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
      let container = document.getElementById("carrinho");
      container.innerHTML = ""; 

      if (carrinho.length > 0) {
        let totalGeral = 0;
        let listaPedidos = "";

        carrinho.forEach((item, index) => {
          let divItem = document.createElement("div");
          divItem.style.border = "1px solid #ccc";
          divItem.style.padding = "10px";
          divItem.style.margin = "10px 0";
          divItem.style.borderRadius = "8px";
          divItem.style.background = "#f9f9f9";

          let descricao = "";

          if (item.produto === "Milkshake") {
            descricao = `${item.produto} - ${item.nome} x${item.quantidade} = R$ ${item.subtotal.toFixed(2).replace(".", ",")}`;
          } else if (item.produto === "A√ßa√≠") {
            let extras = item.extras.map(e => `${e.nome} (+R$ ${e.preco.toFixed(2).replace(".", ",")})`).join(", ");
            descricao = `${item.produto} ${item.tamanho} - Coberturas: ${item.coberturas.join(", ")} - Acompanhamentos: ${item.acompanhamentos.join(", ")} - Extras: ${extras || "Nenhum"} = R$ ${item.subtotal.toFixed(2).replace(".", ",")}`;
          }

          let span = document.createElement("span");
          span.textContent = descricao;

          let btnRemover = document.createElement("button");
          btnRemover.textContent = "‚ùå Remover";
          btnRemover.style.marginLeft = "10px";
          btnRemover.style.background = "#ff4d4d";
          btnRemover.style.color = "#fff";
          btnRemover.style.border = "none";
          btnRemover.style.padding = "5px 10px";
          btnRemover.style.cursor = "pointer";
          btnRemover.style.borderRadius = "6px";

          btnRemover.onclick = () => {
            removerItem(index);
          };

          divItem.appendChild(span);
          divItem.appendChild(btnRemover);
          container.appendChild(divItem);

          totalGeral += item.subtotal;
          listaPedidos += `- ${descricao}\n`;
        });

        let totalP = document.createElement("h2");
        totalP.textContent = "Total: R$ " + totalGeral.toFixed(2).replace(".", ",");
        container.appendChild(totalP);

        localStorage.setItem("resumoPedido", listaPedidos + "\nTotal: R$ " + totalGeral.toFixed(2).replace(".", ","));
      } else {
        container.textContent = "Carrinho vazio.";
      }
    }

    function removerItem(index) {
      let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
      carrinho.splice(index, 1); 
      localStorage.setItem("carrinho", JSON.stringify(carrinho));
      carregarCarrinho();
    }

    function mostrarOpcaoPagamento() {
      let opcao = document.getElementById("pagamento").value;
      document.getElementById("pixInfo").style.display = (opcao === "pix") ? "block" : "none";
      document.getElementById("dinheiroInfo").style.display = (opcao === "dinheiro") ? "block" : "none";
    }

    function copiarPix() {
      let chavePix = "45.371.060/0001-59";
      navigator.clipboard.writeText(chavePix);
      alert("Chave Pix copiada!");
    }

    function enviarWhatsapp() {
      let resumo = localStorage.getItem("resumoPedido") || "";
      let pagamento = document.getElementById("pagamento").value;
      let textoPagamento = "";

      if (pagamento === "pix") {
        textoPagamento = "\nForma de pagamento: Pix ‚úÖ";
      } else if (pagamento === "dinheiro") {
        let troco = document.getElementById("troco").value;
        textoPagamento = `\nForma de pagamento: Dinheiro ‚úÖ ${troco ? "(Troco para R$" + troco + ")" : ""}`;
      } else {
        textoPagamento = "\nForma de pagamento: N√£o informado ‚ö†Ô∏è";
      }

      let textoFinal = "üìã Pedido:\n" + resumo + textoPagamento;

      let numero = "5532984976952"; 
      let url = "https://wa.me/" + numero + "?text=" + encodeURIComponent(textoFinal);

      window.location.href = url;
    }

    carregarCarrinho();
  </script>
</body>
</html>
